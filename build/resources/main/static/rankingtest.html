<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WalkQuest ë­í‚¹ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #111; color: #fff; }
        h2 { color: #00d9ff; }
        input, button { margin: 5px; padding: 5px; border-radius: 6px; border: none; }
        button { background-color: #007bff; color: white; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #result { background-color: #1a1a1a; color: #00ff9d; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>
<h2>ğŸƒâ€â™‚ï¸ WalkQuest ë­í‚¹ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h2>

<label>Base URL:
    <input id="baseUrl" value="http://localhost:8081" />
</label>
<br />

<label>ì•„ì´ë”” (username): <input id="loginUser" /></label>
<label>ë¹„ë°€ë²ˆí˜¸ (password): <input id="loginPass" type="password" /></label>
<button onclick="login()">ë¡œê·¸ì¸</button>
<button onclick="clearToken()">ë¡œê·¸ì•„ì›ƒ</button>
<br />
<label>JWT (ìë™ ì €ì¥/ì ìš©ë¨):</label>
<input id="jwtToken" style="width: 600px;" readonly />
<hr />

<div>
    <button onclick="callApi('/api/ranking/weekly')">ì£¼ê°„ ë­í‚¹</button>
    <button onclick="callApi('/api/ranking/monthly')">ì›”ê°„ ë­í‚¹</button>
    <input id="district" placeholder="êµ¬ ì´ë¦„ ì…ë ¥ (ì˜ˆ: ê°•ë‚¨êµ¬)" />
    <button onclick="fetchDistrict()">êµ¬ë³„ ë­í‚¹</button>
    <br /><br />
    <input id="friendUsername" placeholder="ì•„ì´ë”” ì…ë ¥ (ì˜ˆ: kj77kj)" />
    <button onclick="fetchFriends()">ì¹œêµ¬ ë­í‚¹</button>
</div>

<h3>ê²°ê³¼</h3>
<pre id="result"></pre>

<script>
    // âœ… ë¡œê·¸ì¸ ìš”ì²­
    async function login() {
      const baseUrl = document.getElementById('baseUrl').value;
      const username = document.getElementById('loginUser').value;
      const password = document.getElementById('loginPass').value;
      const resultEl = document.getElementById('result');

      try {
        const res = await fetch(baseUrl + '/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password }),
        });

        const data = await res.json();
        if (data.success && data.data) {
          const token = data.data;
          localStorage.setItem('jwt', token);
          document.getElementById('jwtToken').value = token;
          resultEl.textContent = "âœ… ë¡œê·¸ì¸ ì„±ê³µ! í† í°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.";
        } else {
          resultEl.textContent = "âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + (data.message || 'ì˜¤ë¥˜');
        }
      } catch (err) {
        resultEl.textContent = "âŒ ìš”ì²­ ì‹¤íŒ¨: " + err;
      }
    }

    // âœ… JWT ì œê±° (ë¡œê·¸ì•„ì›ƒ)
    function clearToken() {
      localStorage.removeItem('jwt');
      document.getElementById('jwtToken').value = '';
      document.getElementById('result').textContent = 'ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.';
    }

    // âœ… API í˜¸ì¶œ ê³µí†µ
    async function callApi(endpoint) {
      const baseUrl = document.getElementById('baseUrl').value;
      const token = localStorage.getItem('jwt');
      const resultEl = document.getElementById('result');

      try {
        const res = await fetch(baseUrl + endpoint, {
          headers: token ? { Authorization: 'Bearer ' + token } : {},
        });
        const data = await res.json();
        resultEl.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        resultEl.textContent = "âŒ API í˜¸ì¶œ ì‹¤íŒ¨: " + err;
      }
    }

    // âœ… êµ¬ë³„ ë­í‚¹
    function fetchDistrict() {
      const district = document.getElementById('district').value.trim();
      if (!district) {
        alert('êµ¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
        return;
      }
      callApi('/api/ranking/district/' + encodeURIComponent(district));
    }

    // âœ… ì¹œêµ¬ ë­í‚¹
    function fetchFriends() {
      const username = document.getElementById('friendUsername').value.trim();
      if (!username) {
        alert('ì•„ì´ë””(username)ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
        return;
      }
      callApi('/api/ranking/friends/' + encodeURIComponent(username));
    }

    // âœ… í˜ì´ì§€ ë¡œë“œì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í† í° ì ìš©
    window.onload = () => {
      const saved = localStorage.getItem('jwt');
      if (saved) document.getElementById('jwtToken').value = saved;
    };
</script>
</body>
</html>
